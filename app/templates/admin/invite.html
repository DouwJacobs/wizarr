{% if needUpdate %}
<div class="z-50 fixed left-0 bottom-0 p-4 ">
    <a href="https://github.com/wizarrrr/wizarr">
        <div class="w-full max-w-xl p-6 mt-auto ml-auto bg-slate-700 rounded-lg ">
            <div class="flex items-start justify-between -mx-2">
                <div class="flex items-start px-2">
                    <span class="flex-shrink-0">
                        <svg width="24" height="21" viewBox="0 0 24 21" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M12.0005 15C11.8027 15 11.6093 15.0587 11.4449 15.1686C11.2804 15.2784 11.1523 15.4346 11.0766 15.6173C11.0009 15.8001 10.9811 16.0011 11.0197 16.1951C11.0583 16.3891 11.1535 16.5673 11.2933 16.7071C11.4332 16.847 11.6114 16.9422 11.8054 16.9808C11.9993 17.0194 12.2004 16.9996 12.3831 16.9239C12.5659 16.8482 12.722 16.72 12.8319 16.5556C12.9418 16.3911 13.0005 16.1978 13.0005 16C13.0005 15.7348 12.8951 15.4805 12.7076 15.2929C12.52 15.1054 12.2657 15 12.0005 15ZM22.6705 16.47L14.6205 2.47003C14.3603 2.00354 13.9802 1.61498 13.5196 1.3445C13.0591 1.07401 12.5346 0.931396 12.0005 0.931396C11.4663 0.931396 10.9419 1.07401 10.4813 1.3445C10.0207 1.61498 9.64065 2.00354 9.38046 2.47003L1.38046 16.47C1.11125 16.924 0.966598 17.441 0.9611 17.9688C0.955602 18.4966 1.08945 19.0166 1.34914 19.4761C1.60883 19.9356 1.98516 20.3185 2.44014 20.5861C2.89512 20.8536 3.41264 20.9964 3.94046 21H20.0605C20.5925 21.0053 21.1164 20.8689 21.5784 20.6049C22.0403 20.341 22.4238 19.9589 22.6894 19.4978C22.9551 19.0368 23.0933 18.5134 23.09 17.9814C23.0866 17.4493 22.9418 16.9277 22.6705 16.47ZM20.9405 18.47C20.8528 18.626 20.7249 18.7556 20.5701 18.8453C20.4154 18.935 20.2393 18.9815 20.0605 18.98H3.94046C3.76157 18.9815 3.58556 18.935 3.43077 18.8453C3.27599 18.7556 3.14811 18.626 3.06046 18.47C2.97269 18.318 2.92648 18.1456 2.92648 17.97C2.92648 17.7945 2.97269 17.622 3.06046 17.47L11.0605 3.47003C11.1444 3.30623 11.2719 3.16876 11.4289 3.07277C11.5859 2.97678 11.7664 2.92599 11.9505 2.92599C12.1345 2.92599 12.315 2.97678 12.472 3.07277C12.629 3.16876 12.7565 3.30623 12.8405 3.47003L20.8905 17.47C20.9897 17.6199 21.0467 17.7937 21.0555 17.9732C21.0643 18.1527 21.0245 18.3312 20.9405 18.49V18.47ZM12.0005 7.00003C11.7352 7.00003 11.4809 7.10538 11.2933 7.29292C11.1058 7.48046 11.0005 7.73481 11.0005 8.00003V12C11.0005 12.2652 11.1058 12.5196 11.2933 12.7071C11.4809 12.8947 11.7352 13 12.0005 13C12.2657 13 12.52 12.8947 12.7076 12.7071C12.8951 12.5196 13.0005 12.2652 13.0005 12V8.00003C13.0005 7.73481 12.8951 7.48046 12.7076 7.29292C12.52 7.10538 12.2657 7.00003 12.0005 7.00003Z"
                                fill="#FFC107"></path>
                        </svg>
                    </span>
                    <div class="ml-2">
                        <h5 class="text-gray-100 font-semibold">{{
                            _("Attention!") }}</h5>
                        <span class="text-xs font-medium text-gray-300">{{ _("Update available. Click here.") }}</span>
                    </div>
                </div>
                <div class="px-2">

                </div>
            </div>
        </div>
    </a>
</div>
{% endif %}

<section class="py-5 bg-gray-50 dark:bg-gray-900 animate__animated animate__fadeIn">
    <div class="flex flex-col items-center justify-center px-6 py-8 mx-auto lg:py-0">
        <a class=" flex items-center mb-6 text-2xl font-semibold text-gray-900 dark:text-white">
            {{ _("Quick Invite") }}
        </a>
        <div
            class="w-full bg-white rounded-lg shadow dark:border md:mt-0 sm:max-w-md xl:p-0 dark:bg-gray-800 dark:border-gray-700">
            <div class="p-6 space-y-4 md:space-y-6 sm:p-8">
                <h1 class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white">
                    {{ _("Invite user") }}
                </h1>
                {% if not link %}
                <form class="space-y-4 md:space-y-6" hx-post="/invite" hx-target="#content" hx-swap="innerHTML">
                    <div>
                        <label for="code" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{
                            _("Invite Code String") }} <a class="text-gray-500">{{ _("(optional)") }}</a></label>
                        <input minlength="6" maxlength="6" type="code" name="code" id="code"
                            class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary focus:border-primary block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary dark:focus:border-primary"
                            placeholder="XMFGEJI">
                    </div>
                    <div>
                        <label for="expires" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">{{
                            _("Expiration") }}</label>
                        <select id="expires" name="expires"
                            class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                            <option value="day">{{ _("1 day") }}</option>
                            <option value="week">{{ _("1 week") }}</option>
                            <option value="month">{{ _("1 month") }}</option>
                            <option value="never">{{ _("Never") }}</option>
                        </select>
                    </div>
                    <div>
                        <a href="#" class="block mb-2 text-sm font-medium text-secondary dark:text-primary"
                            onclick="showOptions()">{{ _("Advanced Options") }}</a>

                    </div>
                    <div class="hidden  " id="advanced">
                        <div class="flex items-center mb-4">
                            <input id="unlimited" name="unlimited" type="checkbox" value="  "
                                class="w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                            <label for="unlimited" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">{{
                                _("Unlimited Usages") }}</label>
                        </div>

                        {% if server_type == "plex" %}
                        <div class="flex items-center mb-4">
                            <input id="plex_home" name="plex_home" type="checkbox" value="  "
                                class="w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                            <label for="plex_home" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">{{
                                _("Invite to Plex Home") }}</label>
                        </div>
                        {% endif %}


                        <div class="mb-4">
                            </label>

                            <label for="code" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{
                                _("Duration") }} <a class="text-gray-500">{{ _("(in days)") }}</a><button
                                    data-popover-target="popover-description" data-popover-placement="bottom-end"
                                    type="button"><svg class="w-4 h-4 ml-2 text-gray-400 hover:text-gray-500"
                                        aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
                                        xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd"
                                            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z"
                                            clip-rule="evenodd"></path>
                                    </svg><span class="sr-only">{{ _("Show Information") }}</span></button></label>
                            <div data-popover id="popover-description" role="tooltip"
                                class="absolute z-10 invisible inline-block text-sm font-light text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 w-72 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-400">
                                <div class="p-3 space-y-2">
                                    <h3 class="font-semibold text-gray-900 dark:text-white">{{ _("Duration") }}</h3>
                                    <p>{{ _("When set, invited user(s) will be removed from the Plex server after a
                                        number of
                                        days. (1-999)") }}</p>
                                </div>
                                <div data-popper-arrow></div>
                            </div>


                            <input min="1" max="999" type="number" name="duration"
                                class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary focus:border-primary block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary dark:focus:border-primary">
                        </div>
                        {% if server_type == "plex" %}
                        <div class="flex items-center mb-4">
                            <input id="allowsync" name="allowsync" type="checkbox" value="  "
                                class="w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                            <label for="unlimited" class="ml-2 text-sm font-medium text-gray-900 dark:text-gray-300">{{
                                _("Allow Downloads") }}</label>
                        </div>
                        {% endif %}
                        <div class="mb=4">

                            <label for="plex_libraries"
                                class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{ _("Specific
                                Libraries") }}</label>
                            <a href="#" class="block mb-2 text-sm font-medium text-secondary dark:text-primary"
                                onclick="scanLibraries()">{{ _("Scan For Libraries") }}</a>
                            <input hidden name="library_count" id="library_count" type="number" value="0">
                            <div class="" id="libraries">
                            </div>

                        </div>
                    </div>
                    <button type="submit"
                        class="w-full text-white bg-primary hover:bg-primary_hover focus:ring-4 focus:outline-none focus:ring-amber-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-primary dark:hover:bg-primary_hover dark:focus:ring-primary_hover">{{
                        _("Create Invitation") }}</button>

                </form>
                {% endif %}
                {% if link %}
                <div>
                    <label for="link" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{
                        _("Successfully generated an Invitation!") }}</label>
                    <input disabled type="link" name="link" id="link"
                        class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg focus:ring-primary focus:border-primary block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                        value="{{ link }}">
                    <p hidden id="successfully_copied" class="mt-2 text-sm text-green-600 dark:text-green-500">{{
                        _("Link has been copied to clipboard!") }}
                    </p>

                </div>
                <div class="flex">
                    <div class="w-1/2 text-center">
                        <a hx-get="/invite" hx-trigger="click" hx-target="#content" hx-swap="innerHTML">
                            <button type="back"
                                class="py-2.5 px-5 mr-2 mb-2 text-sm font-medium text-gray-900 focus:outline-none bg-secondary hover:bg-secondary_hover rounded-lg border border-gray-200 hover:bg-secondary_hover focus:z-10 focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700">{{
                                _("Back") }}</button>
                        </a>
                    </div>
                    <div class="w-1/2 text-center">
                        <button onclick="copyLink()" type="share"
                            class="w-3/4 text-white bg-primary hover:bg-primary_hover focus:ring-4 focus:outline-none focus:ring-amber-300 font-medium rounded-lg text-sm px-3 py-2.5 text-center dark:bg-primary dark:hover:bg-primary_hover dark:focus:ring-primary_hover">{{
                            _("Share") }}</button>

                    </div>

                </div>

                {% endif %}
            </div>
        </div>
    </div>
    <script>
        function copyLink() {
            // Get the text field
            var copyText = document.getElementById("link");

            // Select the text field
            copyText.select();
            copyText.setSelectionRange(0, 99999); // For mobile devices

            // Copy the text inside the text field
            navigator.clipboard.writeText(copyText.value);

            //copyText.className =
            //   "bg-green-50 border border-green-500 text-green-900 placeholder-green-700 text-sm rounded-lg focus:ring-green-500 focus:border-green-500 block w-full p-2.5 dark:bg-green-100 dark:border-green-400";
            document.getElementById("successfully_copied").hidden = false;
        }

        function showOptions() {
            var x = document.getElementById("advanced");
            if (x.style.display === "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }
    </script>


    {% if server_type == "plex" %}
    <script>
        function scanLibraries() {

            var container = document.getElementById("libraries");
            while (container.hasChildNodes()) {
                container.removeChild(container.lastChild);
            }
            url = "/scan-specific";
            const response = fetch(url, {
                method: "POST"
            }).then((response) => response.json())
                .then(function (data) {
                    for (var i = 0; i < data.length; i++) {
                        var checkbox = document.createElement("input");
                        checkbox.type = "checkbox";
                        checkbox.name = "library_" + i;
                        checkbox.className =
                            "w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600";
                        checkbox.value = data[i];
                        var label = document.createElement("label");
                        label.for = "library_" + i;
                        label.className = "ml-2 text-sm text-gray-600 dark:text-gray-400";
                        label.innerHTML = data[i];

                        var structure = document.createElement("div");
                        structure.className = "flex items-center mb-4";
                        container.appendChild(structure);
                        container.appendChild(checkbox);
                        container.appendChild(label);

                        var library_count_helper = document.getElementById("library_count");
                        library_count_helper.value = i;
                    }
                })
                .catch(function (error) {
                    var error_message = document.createElement("p");
                    error_message.innerHTML = "Error: Please Check Your Server URL and Token";
                    error_message.className = "mt-2 text-sm text-red-600 dark:text-red-500";
                    container.appendChild(error_message);
                })
        }
    </script>
    {% endif %}

    {% if server_type == "jellyfin" %}
    <script>
        function scanLibraries() {
            var container = document.getElementById("libraries");
            while (container.hasChildNodes()) {
                container.removeChild(container.lastChild);
            }
            var url = "/jf-scan-specific";

            var i = 0;

            fetch(url, {
                method: "POST"
            })
                .then((response) => response.json())
                .then(function (data) {
                    for (var [key, value] of Object.entries(data)) {
                        i = i + 1;
                        var checkbox = document.createElement("input");
                        checkbox.type = "checkbox";
                        checkbox.name = "library_" + i;
                        checkbox.className =
                            "w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600";
                        checkbox.value = value;
                        var label = document.createElement("label");
                        label.for = "library_" + i;
                        label.className = "ml-2 text-sm text-gray-600 dark:text-gray-400";
                        label.innerHTML = key;

                        var structure = document.createElement("div");
                        structure.className = "flex items-center mb-4";
                        container.appendChild(structure);
                        container.appendChild(checkbox);
                        container.appendChild(label);

                        var library_count_helper = document.getElementById("library_count");
                        library_count_helper.value = i;
                    }
                })
                .catch(function (error) {
                    var error_message = document.createElement("p");
                    error_message.innerHTML = "Error: Please Check Your Jellyfin URL and Token";
                    error_message.className = "mt-2 text-sm text-red-600 dark:text-red-500";
                    container.appendChild(error_message);
                })
        }
    </script>
    {% endif %}